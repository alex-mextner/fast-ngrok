# Example Caddy configuration for fast-ngrok
#
# Prerequisites:
# 1. Domain with wildcard DNS: *.tunnel.example.com -> your server IP
# 2. Cloudflare API token for DNS challenge (or another DNS provider)
#
# Usage:
# 1. Copy this file to /etc/caddy/Caddyfile
# 2. Replace tunnel.example.com with your domain
# 3. Set CF_API_TOKEN environment variable
# 4. Run: caddy run --config /etc/caddy/Caddyfile

{
    # Enable Admin API (required for dynamic route management)
    admin localhost:2019
}

# Wildcard domain for tunnels
*.tunnel.example.com {
    # Automatic TLS with DNS challenge (required for wildcard)
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }

    # Proxy all requests to fast-ngrok server
    # The server will route based on subdomain
    reverse_proxy localhost:3100
}

# Optional: Management UI on main domain
tunnel.example.com {
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }

    # Basic status endpoint
    handle /__tunnel__/* {
        reverse_proxy localhost:3100
    }

    # Landing page
    handle {
        respond "fast-ngrok tunnel server" 200
    }
}
